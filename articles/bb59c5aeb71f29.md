---
title: "Goで画像アップロード時に安全にバリデーションするTIPS"
emoji: "🐴"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---



```go
func ValidateUploadImage(file multipart.File) error {
	buf := make([]byte, 512)
	n, err := file.Read(buf)
	if err != nil {
		return err
	}
	// ファイルポインタを先頭に戻す（後で再度全体を読み込むため）
	_, _ = file.Seek(0, io.SeekStart)

	// MIMEタイプを判定
	detectedType := http.DetectContentType(buf[:n])

	allowedTypes := map[string]bool{
		"image/jpeg": true,
		"image/png":  true,
	}

	if !allowedTypes[detectedType] {
		return errors.NewInvalidRequestError("invalid file type")
	}
	return nil
}

```